# B_Python 高级编程第三版

tags: Python 读书笔记 2019 年 12 月 经典书籍

## 第 01 章 Python 现状

**PEP**全称为 Python 改进提案(Python Enhancement Proposal),它是提交 python 变化的书面文档，也是社区对其改变讨论的出发点。

PEP 的主要作用：

- **通知**：汇总 Python 核心开发者需要的信息，并通知 Python 发布日程
- **标准化**：提供代码风格、文档或其他指导意见
- **设计**：对提交的功能进行说明

所有提交的 PEP 都会被汇总到一个文件中，例如[PEP0](https://www.python.org/dev/peps)

### Python3 和 Python2 主要差异

由于 Python3 打破了 Python2 的向后兼容性，所以 Python3 不完全支持 Python2 代码,其中存在许多差异,需要了解。

主要差异：

- 语法差异
  - print 不再是语句，而是函数，需要 print("xxx")
  - 捕获异常有 except exc, var 修改为 `except exc as var`
  - 放弃使用<>，改用 !=
  - from module import \* 只能用于模块，不能用于函数
  - `from .[module] import name`是相对导入的唯一正确语法，所有不以.开头的导入都被当成绝对导入
  - 去除 cmp 函数
  - 除法修改
- 标准库差异
  - 标准库名称或使用方式发生变化
- 数据类型和集合的变化
  - 字符串类型修改等

### 保持版本兼容的常用工具和技术

管理兼容性未来变化的最佳方法，就是正确使用语义化版本的版本号。这是一个广为接受的标准，用仅包含三个数字的版本标识符来标记代码的变化范围

- 主版本号(MAJOR): 当做了不兼容的 API 修改
- 次版本号(MINOR)：当做了向后兼容的功能性新增
- 修订号(PATCH)：当做了向后兼容的问题修正

软件版本阶段说明

- Alpha 版: 此版本表示该软件在此阶段主要是以实现软件功能为主，通常只在软件开发者内部交流，一般而言，该版本软件的 Bug 较多，需要继续修改。
- Beta 版: 该版本相对于 α 版已有了很大的改进，消除了严重的错误，但还是存在着一些缺陷，需要经过多次测试来进一步消除，此版本主要的修改对像是软件的 UI。
- RC 版: 该版本已经相当成熟了，基本上不存在导致错误的 BUG，与即将发行的正式版相差无几。
- Release 版: 该版本意味“最终版本”，在前面版本的一系列测试版之后，终归会有一个正式版本，是最终交付用户使用的一个版本。该版本有时也称为标准版。一般情况下，Release 不会以单词形式出现在软件封面上，取而代之的是符号(R)。

软件版本号由四部分组成：
第一个 1 为主版本号，第二个 1 为子版本号，第三个 1 为阶段版本号，第四部分为日期版本号加希腊字母版本号，希腊字母版本号共有 5 种，分别为：base、alpha、beta、RC、release。

版本号定修改规则
例如：1.1.1.051021_beta。

- 主版本号(1)：当功能模块有较大的变动，比如增加多个模块或者整体架构发生变化。此版本号由项目决定是否修改。
- 子版本号(1)：当功能有一定的增加或变化，比如增加了对权限控制、增加自定义视图等功能。此版本号由项目决定是否修改。
- 阶段版本号(1)：一般是 Bug 修复或是一些小的变动，要经常发布修订版，时间间隔不限，修复一个严重的 bug 即可发布一个修订版。此版本号由项目经理决定是否修改。
- 日期版本号(051021):用于记录修改项目的当前日期，每天对项目的修改都需要更改日期版本号。此版本号由开发人员决定是否修改。
- 希腊字母版本号(beta):此版本号用于标注当前版本的软件处于哪个开发阶段，当软件进入到另一个阶段时需要修改此版本号。此版本号由项目决定是否修改。

### Python 实现

TODO

Python 的几种实现方式

- Cpython: 重要 Python 代码使用 C 实现
- StacklessPython: 无栈，没有依赖 C 语言的调用栈，使用修改后的 C 语言编写的
- Jython: Java-Python，Python 语言的 java 实现
  - 真正的 Java 垃圾回收，而不是引用计数
  - 没有**全局解释器**(Global Interpreter Lock,GIL),多线程应用中可以充分使用多内核
- IronPython：将 Python 引入.Net 框架。
  - 没有 GIL 锁
  - C#,其他.Net 语言可以和 IronPython 方便互相集成
  - 通过 silverlight,可以运行在所有主流浏览器中
- PyPy: 使用 Python 重写 python
  - 使用垃圾回收，而不是引用计数
  - 集成跟踪 JIT 编译器,可以显著提升性能
  - 借鉴了 StacklessPython 在应用层的无栈特性

PythonShell

- Ipython
- bpython
- ptpython

TODO **交互式调试器 pdb**待使用测试

TODO vagrant

TODO 容器化与虚拟化的对比

有用资源

- **Awesome-python**
- python 官方文档
- PyPi
- PEP8

## 第 02 章 语法最佳实践-类级别以下

### 数据类型

Python 数据类型

- 列表 list
- 元组 tuple
- 字典 dict
- 集合 set
- 字符串 str
- ...

```python
# enumerate 枚举元素
for i, element in enumerate(['a','b']):
    print i, element
0 a
1 b

# zip 合并列表
for item in zip([1,2,3],[2,3,4]):
    print item
(1,2)
(2,3)

# zip 恢复原状
for item in zip(*zip([1,2,3],[2,3,4])):
    print item
(1,2,3)
(2,3,4)

# 序列解包
In [3]: a,b,c=1,2,3
In [4]: print(a,b,c)
1 2 3

In [1]: a,b,*c = 1,2,3,4,5,6
In [2]: print(a,b,c)
1 2 [3, 4, 5, 6]

In [5]: a,*b,c=1,2,3,4,5,6
In [6]: print(a,b,c)
1 [2, 3, 4, 5] 6
```

**字典:**

使用字典的常用陷阱之一，就是它并不会按照键的添加顺序来保存元素的顺序,在某些情况下,字典的键是连续的,对应的 Val 也是连续的,那么由于字典的内部实现,元素的顺序可能和添加顺序相同。

OrderDict 保存有序字典

**集合:**

- set() 可变的,无序的,有限的集合。其元素值时唯一、不可变的 hash 对象.
- forzenset() 不可变的、可哈希的、无序的集合，其元素是唯一的、不可变的 hash 对象.

TODO 熟练 collections 模块
**超越基础集合类型-collections 模块:**

- nametuple 创建元组子类的工厂函数，可以通过属性名访问元索引
- deque 双端队列，类似列表，可以在两端快速添加或取出数据
- ChinaMap 类似字典类，用于创建多个映射的单一视图
- Counter 字典子类，用于对可哈希对象进行计数
- OrderDict 字典子类,可以保存元素的添加顺序
- defaultdict 字典子类, 可以调用用户自定义的工厂函数来设置缺失值(默认值)

### 高级语法

**迭代器:**

迭代器只不过一个实现了迭代器协议的容器对象,基于以下两个方法:

1. `__next__` 返回容器的下一个元素
2. `__iter__` 返回迭代器本身

迭代器可通过内置函数`iter`创建,例如`a=iter('abc')`

TODO 如何熟练的时用生成器，yield 语句

**yield 语句**
基于 yield 语句,函数可以暂停函数并返回一个中间结果。该函数会保存执行上下文，并在需要时进行恢复。

生成器方法

- next
- send
- close
- throw

## 第 04 章 Pep8 命令风格

**Python 命名风格:**

- 驼峰式命名法 CamelCase
- 混合式命名法 mixedCase
- 大写 UPPERCASE 或 大写下划线 UPPER_CASE_WTTH_SCORES
- 前缀或后缀下划线`_`/双下划线`__`

**命名风格应用场景:**

- 变量
- 函数和方法
- 属性 property
- 类
- 模块
- 包

**风格应用案例:**

- 变量
  - 全局变量常量 使用`大写加下划线(UPPER_CASE)`标明指定的变量为常数值
  - 私有变量应该加`前缀下划线(_msg)`,保护变量和避免被其他人调用。
- 函数和方法
  - 函数和方法名称应该使用`小写加下划线(upper_case)`，通常使用动词短语
- 参数
  - 参数名称使用`小写或小写加下划线(dic or upper_dic)`
- 属性 property
  - 类属性名称使用 `小写或小写加下划线(dic or upper_dic)`，表明一个对象的状态, 可以是`名词或形容词`
- 类
  - 类名称使用`驼峰命名法`,类和实例变量通常是名词短语
  - 类的名称必须简明、精确，并足以使人理解类的作用，通常使用前缀来表示其类型或特性
    - **Test**Case **SQL**Engine **String**Widget
    - 基类 BaseCookie
    - 抽象类 AbstractFromatter
    - 和类属性保持一致，尽量避免类和属性名称之间的冗余
- 模块和包
  - 除了特殊模块`__init__`之外,模块名称使用小写,不带下划线
  - 如何模块是包的私有模块,则需要带一个下划线
  - 模块的名称应体现其内容的目的,名称简短,小写字母,不带下划线
    - 如果实现了一个协议,通常使用 lib 后缀, url**lib**
- 推荐风格使用
  - 常量集中在模块顶部,也可以组合在新的变量中
  - 常量可以集中在一个配置文件中，方便统一管理
    - 使用 config.py 或使用 config.ini 然后利用脚本解析变量。

**命名指南:**

- 用 has 或 is 前缀命名布尔元素
- 用复数形式命名集合变量
- 用显示名称命名字典`persons_phones={'Tom':'123123'}`
- 避免使用通常名称(含义模糊)和内置名称
- 避免使用现有名称

**参数最佳实践:**

- 通过迭代设计构建参数
  - 提供固定、定义明确的参数列表,有利于提升代码的鲁棒性
  - 添加新的参数时，尽可能应该有默认值
- 参数检查
  - 契约式设计(Design by Contract Dbc): 在函数和方
  - 法的顶部使用断言来检查参数
- 小心使用魔法参数`*args,**kwargs`,会破坏函数的鲁棒性，使得签名变的模糊

TODO 如何更好的进行参数检查？？？

**工具推荐:**

- Pylint 代码风格/质量检查
- autopep8 代码风格检查(可以进行代码简单调整)
- IDE-环境编辑器 现有 IDE 支持代码风格优化,可以使用 IDE 简化操作

TODO Sphinx_doc 注释风格 & 生成注释文档软件
